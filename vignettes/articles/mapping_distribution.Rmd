---
title: "Mapping global distribution for any genus"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Mapping global distribution for any genus}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The main goal of the __expowo__ package is to retrieve information about the 
diversity and distribution of any plant family as publicly available at the 
taxonomically verified database 
[Plants of the World Online (POWO)](https://powo.science.kew.org).\

The package is intended to efficiently mine the content within the source HTML 
pages for any specific genus and family. It can return a comma-separated values 
(CSV) file with the number of accepted species and country-level distribution 
for any genus as well as the full checklist of accepted species in any genus or 
family, their authorship, original publication and global distribution.\

Here in this article, we show how to use the package's function `powoMap` 
for mapping the global distribution for any genus of flowering plants either at political country or botanical country level. The 
`powoMap` uses the argument `data` to set the input data, which has to be
a data frame originated from `powoSpecies` function. Then, this function create
global distribution maps to each genus provided in the previous search results, colored according to species richness using either [Viridis](https://CRAN.R-project.org/package=viridis) color paletts or [RColorBrewer](https://CRAN.R-project.org/package=RColorBrewer).

# Setup

__expowo__ is not on CRAN yet but you can install the latest development version 
from [GitHub](https://github.com/):

``` r
#install.packages("devtools")
devtools::install_github("DBOSlab/expowo")
```
```{r package load}
library(expowo)
```

# 1. Mining species distribution from POWO to use as input data in powoMap

To create global distribution maps, first we need to extract the data. To do so, we use the package function `powoSpecies` to return a data frame listing the 
entire global distribution at country or botanical level for any species of the given family. It is also possible to adjust one of the arguments in `powoSpecies` function to extract data only from a genus or list of genera.\

The example below shows how to mine the distribution for Lecythidaceae family with genus constriction. It means that the function will search for Bertholletia genus within this family and their associated data. Note that we create an object called `mapspdist` to be used in the next step as input to create the maps. The output shown here (a table) is simplified by removing some columns and display the data for only one species (_B. excelsa_).\

```{r, eval = FALSE}
library(taxize)
fam <- "Lecythidaceae"
powocodes <- cbind(family = fam,
                   data.frame(taxize::get_pow(fam)))

mapspdist <- powoSpecies(powocodes$family, powocodes$uri,
                         hybridspp = FALSE,
                         country = NULL,
                         genus = "Bertholletia",
                         verbose = TRUE,
                         save = TRUE,
                         dir = "results_powoSpecies/",
                         filename = "Lecythidaceae_Bertholletia")
```

```{r, echo = FALSE, warning = FALSE}
data("POWOcodes")
fam <- "Lecythidaceae"
powocodes <- data.frame(family = fam,
                        uri = POWOcodes$uri[POWOcodes$family %in% fam])

res <- powoSpecies(powocodes$family, powocodes$uri,
                         hybridspp = FALSE,
                         country = NULL,
                         genus = "Bertholletia",
                         verbose = FALSE,
                         save = FALSE,
                         dir = "results_powoSpecies/",
                         filename = "Lecythidaceae_Bertholletia")

knitr::kable(res[-c(1, 3, 5, 6, 7, 10, 11, 12, 13)],
             align = 'c',
             caption = "TABLE 1. A general `powoSpecies` search for mining 
             distribution for _Bertholletia_, a Lecythidaceae genus.")
```


# 2. Creating global-scale map divided by political country for one genus

As generated in the example above, one of the columns from the `mapspdist` object related to the global distribution by political countries of _Bertholletia_ will be used in `map_div` argument inside `powoMap` function. The columns selected is "native_to_country", associated to political country.\

The example below shows how to create a global distribution map according to political division of the World (see argument `map_div`), colored by species richness using Viridis package (see argument `vir_color` set up with one scale colors called viridis and the argumten `bre_color`set up as \code{NULL}).\


```{r, eval = FALSE}
powoMap(data = mapspdist,
        botctrs = NULL,
        map_div = "native_to_country",
        multigen = TRUE,
        verbose = FALSE,
        vir_color = "viridis",
        bre_color = NULL,
        leg_title = "SR",
        dpi = 600,
        dir = "results_powoMap/",
        filename = "global_richness_country_map",
        format = "jpg") 
```

\
![](man/figures/global_richness_country_map_SR_Bertholletia_viridis.jpg){width=30%}


# 3. Creating global-scale map divided by botanical country for one genus

As shown in the first topic of this article, one of the columns from the `mapspdist` object related to distribution of _Bertholletia_ will be used in `map_div` argument inside `powoMap` function. In this topic, the aim is to show the distribution according to botanical subdivision of the world ("native_to_botanical_countries" column).\

The example below show how to create a global distribution map according to botanical subdivision of the World (see argument `map_div`), colored by species richness using Viridis package (see argument `vir_color` set up with one scale colors called viridis and the argumten `bre_color`set up as \code{NULL}).\


```{r, eval = FALSE}
data(botdivmap)
powoMap(data = mapspdist,
        botctrs = botdivmap,
        map_div = "native_to_botanical_countries",
        multigen = TRUE,
        verbose = FALSE,
        vir_color = "viridis",
        bre_color = NULL,
        leg_title = "SR",
        dpi = 600,
        dir = "results_powoMap/",
        filename = "global_richness_botcountry_map",
        format = "jpg")
```

\
![](man/figures/global_richness_botcountry_map_SR_Bertholletia_viridis.jpg){width=30%}

